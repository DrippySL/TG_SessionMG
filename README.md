# Система управления Telegram аккаунтами

Это система для управления корпоративными Telegram аккаунтами с возможностью массовой проверки, повторной авторизации и возврата аккаунтов.

## Особенности

- Управление множеством Telegram аккаунтов через единый интерфейс
- Фоновая проверка аккаунтов с анти-флуд задержками
- Групповые операции (проверка, повторная авторизация, возврат аккаунтов)
- Безопасное хранение сессий (шифрование)
- Мониторинг прогресса задач в реальном времени
- Поддержка 2FA (двухфакторная аутентификация)

## Технологии

- Backend: Django, Django REST Framework, Celery, Redis, PostgreSQL
- Frontend: React, Material-UI
- Инфраструктура: Docker, Nginx

## Быстрый старт

### Предварительные требования

- Docker и Docker Compose
- Telegram API ID и API Hash (получить на https://my.telegram.org)

### Установка

1. Клонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd tg_session
   ```

2. Создайте файл `.env` на основе `.env.example`:
   ```bash
   cp .env.example .env
   ```

3. Отредактируйте `.env` файл, установите свои значения:
   - `DJANGO_SECRET_KEY`: сгенерируйте случайный ключ
   - `ENCRYPTION_KEY`: сгенерируйте ключ шифрования (минимум 32 символа)
   - `POSTGRES_PASSWORD`: установите надежный пароль
   - Остальные настройки можно оставить по умолчанию

4. Запустите проект:
   ```bash
   docker-compose up -d
   ```

5. Примените миграции и создайте суперпользователя:
   ```bash
   docker-compose exec backend python manage.py migrate
   docker-compose exec backend python manage.py createsuperuser
   ```

6. Настройте глобальные API ключи Telegram:
   - Войдите в админ-панель: http://localhost:8000/admin
   - Перейдите в раздел "Global App Settings"
   - Добавьте API ID и API Hash, полученные на my.telegram.org

7. Откройте веб-интерфейс: http://localhost:3000

## Использование

### Добавление аккаунта

1. В веб-интерфейсе нажмите "Добавить новый аккаунт"
2. Заполните данные аккаунта (номер телефона, ФИО сотрудника, ID сотрудника, email для восстановления)
3. Отправьте код подтверждения (придет SMS)
4. Введите код подтверждения
5. Если аккаунт защищен 2FA, введите пароль 2FA

### Управление аккаунтами

- **Панель управления**: просмотр всех аккаунтов, фильтрация по статусу, поиск
- **Групповые операции**: выберите несколько аккаунтов и запустите проверку
- **Действия с аккаунтом**: смена пароля, удаление сессии, повторная авторизация, возврат аккаунта

### Возврат аккаунта

Возврат аккаунта выполняет следующие действия:
- Завершает ВСЕ активные сессии на всех устройствах
- Меняет пароль (если 2FA не включено или известен пароль)
- Удаляет сессию из базы данных
- Изменяет статус аккаунта на "возвращен"

## Разработка

### Локальная разработка

1. Установите Python зависимости:
   ```bash
   cd backend
   pip install -r requirements.txt
   ```

2. Запустите Redis и PostgreSQL (через Docker или локально)

3. Запустите Django:
   ```bash
   python manage.py runserver
   ```

4. Запустите Celery worker:
   ```bash
   celery -A core worker --loglevel=info
   ```

5. Запустите фронтенд:
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

### Структура проекта

- `backend/`: Django приложение
  - `accounts/`: основное приложение для управления аккаунтами
  - `core/`: настройки проекта
- `frontend/`: React приложение
- `nginx/`: конфигурация Nginx
- `init.sql`: SQL скрипт для инициализации базы данных
- `docker-compose.yml`: конфигурация Docker Compose

## Безопасность

- Все критические данные (сессии, API ключи) хранятся в зашифрованном виде
- Используется отдельный ключ шифрования (ENCRYPTION_KEY)
- CSRF защита включена
- CORS настроен только для разрешенных источников
- В продакшене используйте HTTPS

## Лицензия

Проприетарное программное обеспечение.